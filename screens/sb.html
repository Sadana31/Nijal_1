<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Shipping Bill Details</title>

  <link href="../styles/ms.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
</head>

<body>

  <div id="sidebar-placeholder"></div>

  
  <div class="main-content" id="main-content">
    <h2>SB Details Dashboard</h2>
    <br />

    <div class="search-container">
      <label for="search-currency">Search by Currency:</label>
      <input type="text" id="search-currency" placeholder="e.g. USD" />

      <div class="button-group" style="margin-top: -1px; margin-left: 350px;">
        <a href="add_sb.html" class="btn-go-to-add-sb"></a>
        <button onclick="window.location.href='add_sb.html'" class="btn-top">Add Shipping Bill</button>

        <a href="upload_sb.html" class="btn-go-to-add-sb"></a>
        <button onclick="window.location.href='upload_sb.html'" class="btn-top">Bulk Shipping Bill Upload</button>

        <button class="btn-top" onclick="downloadSample()">Export File</button>
      </div>

    </div>

    

    <div style="text-align: left; margin-bottom: 20px;">
      <label for="entriesSelect">Show 
        <select id="entriesSelect" onchange="changeEntries()">
          <option value="15">5</option>
          <option value="30" selected>10</option>
          <option value="75">25</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select> entries
      </label>
    </div>
 
    <!-- Search Row Table -->
    <table style="width: 100%; border-collapse: collapse; margin-bottom: 5px;">
      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td><input type="text" class="column-filter" onkeyup="filterTable(2, this.value)" placeholder="Shipping Bill"></td>
        <td><input type="text" class="column-filter" onkeyup="filterTable(3, this.value)" placeholder="Form No"></td>
        <td><input type="text" class="column-filter" onkeyup="filterTable(4, this.value)" placeholder="Date"></td>
        <td><input type="text" class="column-filter" onkeyup="filterTable(5, this.value)" placeholder="Port Code"></td>
        <td><input type="text" class="column-filter" onkeyup="filterTable(6, this.value)" placeholder="Bank Name"></td>
        <td><input type="text" class="column-filter" onkeyup="filterTable(7, this.value)" placeholder="Invoice Count"></td>
        <td><input type="text" class="column-filter" onkeyup="filterTable(8, this.value)" placeholder="Currency"></td>
        <td><input type="text" class="column-filter" onkeyup="filterTable(9, this.value)" placeholder="Export Value"></td>
        <td><input type="text" class="column-filter" onkeyup="filterTable(10, this.value)" placeholder="Outstanding"></td>
        <td><input type="text" class="column-filter" onkeyup="filterTable(11, this.value)" placeholder="Buyer Name"></td>
        <td>
          <div class="autocomplete">
            <input id="countryInput" type="text" placeholder="Start typing code or country..." class="column-filter" onkeyup="filterTable(12, this.value)"/>
          </div>
        </td>
      </tr>
    </table>

    <table border="1" id="mainTable" style="width: 100%; border-collapse: collapse;">
      <thead>
        <tr>
          <th></th>
          <th></th>
          <th>Shipping Bill</th>
          <th>Form No</th>
          <th>Shipping Bill Date</th>
          <th>Port Code</th>
          <th>Bank Name</th>
          <th>Invoice Count</th>
          <th>FOB Currency</th>
          <th>Export Bill Value</th>
          <th>Bill Outstanding Value</th>
          <th>Buyer Name</th>
          <th>Buyer Country Code</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="checkbox" name="sbSelect" value="0002GRS12345678"></td>
          <td class="expand-toggle" onclick="toggleExpander(this)" style="cursor: pointer; user-select:none; text-align:center; font-weight:bold;">
            ▸
          </td>
          <td>1234567</td>
          <td>NA</td>
          <td>10-05-2024</td>
          <td>INBOM4</td>
          <td>ICICI Bank</td>
          <td>1</td>
          <td>USD</td>
          <td>10,000.00</td>
          <td>6,000.00</td>
          <td>ABC Limited</td>
          <td>US</td>
        </tr>

        <tr class="expander" style="display: none;">
          <td colspan="13" style="padding: 0;">
            <table border="1" style="width: 100%; border-collapse: collapse; margin: 0;">
              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>IE Code</th>
                  <th>Invoice Date</th>
                  <th>Realized Value</th>
                  <th>Buyer Address</th>
                  <th>Consignee Country Code</th>
                  <th>Port of Destination</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>123456789</td>
                  <td>05-05-2024</td>
                  <td>$4,000.00</td>
                  <td>Test Address</td>
                  <td>IN</td>
                  <td>US</td>
                </tr>
              </tbody>

              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>Shipping Company</th>
                  <th>Vessel Name</th>
                  <th>BL Date</th>
                  <th>Commercial Invoice</th>
                  <th>Trade Terms</th>
                  <th>Commodity</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>Maersk</td>
                  <td>Vessel 55555</td>
                  <td>06-05-2024</td>
                  <td>21127240024</td>
                  <td>-</td>
                  <td>Heavy metal goods</td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
        <tr>
          <td><input type="checkbox" name="sbSelect" value="0002GRS12345678"></td>
          <td onclick="toggleExpander(this)" style="cursor: pointer; user-select:none; text-align:center; font-weight:bold;">
            ▸
          </td>
          <td>1234567</td>
          <td>NA</td>
          <td>10-05-2024</td>
          <td>INBOM4</td>
          <td>ICICI Bank</td>
          <td>1</td>
          <td>USD</td>
          <td>10,000.00</td>
          <td>6,000.00</td>
          <td>ABC Limited</td>
          <td>US</td>
        </tr>

        <tr class="expander" style="display: none;">
          <td colspan="13" style="padding: 0;">
            <table border="1" style="width: 100%; border-collapse: collapse; margin: 0;">
              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>IE Code</th>
                  <th>Invoice Date</th>
                  <th>Realized Value</th>
                  <th>Buyer Address</th>
                  <th>Consignee Country Code</th>
                  <th>Port of Destination</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td> 
                  <td>123456789</td>
                  <td>05-05-2024</td>
                  <td>$4,000.00</td>
                  <td>Test Address</td>
                  <td>IN</td>
                  <td>US</td>
                </tr>
              </tbody>

              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>Shipping Company</th>
                  <th>Vessel Name</th>
                  <th>BL Date</th>
                  <th>Commercial Invoice</th>
                  <th>Trade Terms</th>
                  <th>Commodity</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>Maersk</td>
                  <td>Vessel 55555</td>
                  <td>06-05-2024</td>
                  <td>21127240024</td>
                  <td>-</td>
                  <td>Heavy metal goods</td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>

        <tr class="expander" style="display: none;">
          <td colspan="13" style="padding: 0;">
            <table border="1" style="width: 100%; border-collapse: collapse; margin: 0;">
              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>IE Code</th>
                  <th>Invoice Date</th>
                  <th>Realized Value</th>
                  <th>Buyer Address</th>
                  <th>Consignee Country Code</th>
                  <th>Port of Destination</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>123456789</td>
                  <td>05-05-2024</td>
                  <td>$4,000.00</td>
                  <td>Test Address</td>
                  <td>IN</td>
                  <td>US</td>
                </tr>
              </tbody>

              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>Shipping Company</th>
                  <th>Vessel Name</th>
                  <th>BL Date</th>
                  <th>Commercial Invoice</th>
                  <th>Trade Terms</th>
                  <th>Commodity</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>Maersk</td>
                  <td>Vessel 55555</td>
                  <td>06-05-2024</td>
                  <td>21127240024</td>
                  <td>-</td>
                  <td>Heavy metal goods</td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
        <tr>
          <td><input type="checkbox" name="sbSelect" value="0002GRS12345678"></td>
          <td onclick="toggleExpander(this)" style="cursor: pointer; user-select:none; text-align:center; font-weight:bold;">
            ▸
          </td>
          <td>1234567</td>
          <td>NA</td>
          <td>10-05-2024</td>
          <td>INBOM4</td>
          <td>ICICI Bank</td>
          <td>1</td>
          <td>USD</td>
          <td>10,000.00</td>
          <td>6,000.00</td>
          <td>ABC Limited</td>
          <td>US</td>
        </tr>

        <tr class="expander" style="display: none;">
          <td colspan="13" style="padding: 0;">
            <table border="1" style="width: 100%; border-collapse: collapse; margin: 0;">
              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>IE Code</th>
                  <th>Invoice Date</th>
                  <th>Realized Value</th>
                  <th>Buyer Address</th>
                  <th>Consignee Country Code</th>
                  <th>Port of Destination</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>123456789</td>
                  <td>05-05-2024</td>
                  <td>$4,000.00</td>
                  <td>Test Address</td>
                  <td>IN</td>
                  <td>US</td>
                </tr>
              </tbody>

              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>Shipping Company</th>
                  <th>Vessel Name</th>
                  <th>BL Date</th>
                  <th>Commercial Invoice</th>
                  <th>Trade Terms</th>
                  <th>Commodity</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>Maersk</td>
                  <td>Vessel 55555</td>
                  <td>06-05-2024</td>
                  <td>21127240024</td>
                  <td>-</td>
                  <td>Heavy metal goods</td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
        <tr>
          <td><input type="checkbox" name="sbSelect" value="0002GRS12345678"></td>
          <td onclick="toggleExpander(this)" style="cursor: pointer; user-select:none; text-align:center; font-weight:bold;">
            ▸
          </td>
          <td>1234567</td>
          <td>NA</td>
          <td>10-05-2024</td>
          <td>INBOM4</td>
          <td>ICICI Bank</td>
          <td>1</td>
          <td>USD</td>
          <td>10,000.00</td>
          <td>6,000.00</td>
          <td>ABC Limited</td>
          <td>US</td>
        </tr>

        <tr class="expander" style="display: none;">
          <td colspan="13" style="padding: 0;">
            <table border="1" style="width: 100%; border-collapse: collapse; margin: 0;">
              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>IE Code</th>
                  <th>Invoice Date</th>
                  <th>Realized Value</th>
                  <th>Buyer Address</th>
                  <th>Consignee Country Code</th>
                  <th>Port of Destination</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>123456789</td>
                  <td>05-05-2024</td>
                  <td>$4,000.00</td>
                  <td>Test Address</td>
                  <td>IN</td>
                  <td>US</td>
                </tr>
              </tbody>

              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>Shipping Company</th>
                  <th>Vessel Name</th>
                  <th>BL Date</th>
                  <th>Commercial Invoice</th>
                  <th>Trade Terms</th>
                  <th>Commodity</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>Maersk</td>
                  <td>Vessel 55555</td>
                  <td>06-05-2024</td>
                  <td>21127240024</td>
                  <td>-</td>
                  <td>Heavy metal goods</td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
        <tr>
          <td><input type="checkbox" name="sbSelect" value="0002GRS12345678"></td>
          <td onclick="toggleExpander(this)" style="cursor: pointer; user-select:none; text-align:center; font-weight:bold;">
            ▸
          </td>
          <td>1234567</td>
          <td>NA</td>
          <td>10-05-2024</td>
          <td>INBOM4</td>
          <td>ICICI Bank</td>
          <td>1</td>
          <td>USD</td>
          <td>10,000.00</td>
          <td>6,000.00</td>
          <td>ABC Limited</td>
          <td>US</td>
        </tr>

        <tr class="expander" style="display: none;">
          <td colspan="13" style="padding: 0;">
            <table border="1" style="width: 100%; border-collapse: collapse; margin: 0;">
              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>IE Code</th>
                  <th>Invoice Date</th>
                  <th>Realized Value</th>
                  <th>Buyer Address</th>
                  <th>Consignee Country Code</th>
                  <th>Port of Destination</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>123456789</td>
                  <td>05-05-2024</td>
                  <td>$4,000.00</td>
                  <td>Test Address</td>
                  <td>IN</td>
                  <td>US</td>
                </tr>
              </tbody>

              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>Shipping Company</th>
                  <th>Vessel Name</th>
                  <th>BL Date</th>
                  <th>Commercial Invoice</th>
                  <th>Trade Terms</th>
                  <th>Commodity</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>Maersk</td>
                  <td>Vessel 55555</td>
                  <td>06-05-2024</td>
                  <td>21127240024</td>
                  <td>-</td>
                  <td>Heavy metal goods</td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
        <tr>
          <td><input type="checkbox" name="sbSelect" value="0002GRS12345678"></td>
          <td onclick="toggleExpander(this)" style="cursor: pointer; user-select:none; text-align:center; font-weight:bold;">
            ▸
          </td>
          <td>1234567</td>
          <td>NA</td>
          <td>10-05-2024</td>
          <td>INBOM4</td>
          <td>ICICI Bank</td>
          <td>1</td>
          <td>USD</td>
          <td>10,000.00</td>
          <td>6,000.00</td>
          <td>ABC Limited</td>
          <td>US</td>
        </tr>

        <tr class="expander" style="display: none;">
          <td colspan="13" style="padding: 0;">
            <table border="1" style="width: 100%; border-collapse: collapse; margin: 0;">
              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>IE Code</th>
                  <th>Invoice Date</th>
                  <th>Realized Value</th>
                  <th>Buyer Address</th>
                  <th>Consignee Country Code</th>
                  <th>Port of Destination</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>123456789</td>
                  <td>05-05-2024</td>
                  <td>$4,000.00</td>
                  <td>Test Address</td>
                  <td>IN</td>
                  <td>US</td>
                </tr>
              </tbody>

              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>Shipping Company</th>
                  <th>Vessel Name</th>
                  <th>BL Date</th>
                  <th>Commercial Invoice</th>
                  <th>Trade Terms</th>
                  <th>Commodity</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>Maersk</td>
                  <td>Vessel 55555</td>
                  <td>06-05-2024</td>
                  <td>21127240024</td>
                  <td>-</td>
                  <td>Heavy metal goods</td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
        <tr>
          <td><input type="checkbox" name="sbSelect" value="0002GRS12345678"></td>
          <td onclick="toggleExpander(this)" style="cursor: pointer; user-select:none; text-align:center; font-weight:bold;">
            ▸
          </td>
          <td>1234567</td>
          <td>NA</td>
          <td>10-05-2024</td>
          <td>INBOM4</td>
          <td>ICICI Bank</td>
          <td>1</td>
          <td>USD</td>
          <td>10,000.00</td>
          <td>6,000.00</td>
          <td>ABC Limited</td>
          <td>US</td>
        </tr>

        <tr class="expander" style="display: none;">
          <td colspan="13" style="padding: 0;">
            <table border="1" style="width: 100%; border-collapse: collapse; margin: 0;">
              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>IE Code</th>
                  <th>Invoice Date</th>
                  <th>Realized Value</th>
                  <th>Buyer Address</th>
                  <th>Consignee Country Code</th>
                  <th>Port of Destination</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>123456789</td>
                  <td>05-05-2024</td>
                  <td>$4,000.00</td>
                  <td>Test Address</td>
                  <td>IN</td>
                  <td>US</td>
                </tr>
              </tbody>

              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th>Shipping Company</th>
                  <th>Vessel Name</th>
                  <th>BL Date</th>
                  <th>Commercial Invoice</th>
                  <th>Trade Terms</th>
                  <th>Commodity</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td>Maersk</td>
                  <td>Vessel 55555</td>
                  <td>06-05-2024</td>
                  <td>21127240024</td>
                  <td>-</td>
                  <td>Heavy metal goods</td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>   
    </table>

    <br />


<div class="button-group">
  <button class="btn-top" onclick="showSelectedDetails()">Details</button>
  <a href="upload_sb.html" class="btn-go-to-add-sb"></a>
  <button class="btn-top"  id="proceedBtn">Proceed to IRM Mapping</button>
  <button class="btn-top" onclick="modifySelectedSB()">Modify SB</button>
</div>
<!-- Modal -->
<div class="modal fade" id="detailsModal" tabindex="-1" aria-labelledby="detailsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="detailsModalLabel">Shipping Bill Details</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="modalContent" class="container-fluid">
          <!-- Populated dynamically -->
        </div>
      </div>
    </div>
  </div>
</div> 

<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
  <div id="sbToast" class="toast align-items-center text-white bg-danger border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body" id="toastMsg">Please select a Shipping Bill</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>


  



<script>
  document.getElementById("proceedBtn").addEventListener("click", function () {
    const selected = document.querySelectorAll('input[name="sbSelect"]:checked');
    
    if (selected.length > 1 || selected.length < 1) {
      document.getElementById("toastMsg").innerText = "Please select one Shipping Bill to proceed.";
      const toastEl = new bootstrap.Toast(document.getElementById("sbToast"));
      toastEl.show();
    } else {
      // Optionally store selected SB
      // sessionStorage.setItem("selectedSB", selected.value);
      window.location.href = "../screens/mapping.html";
    }
  });
</script>


<script>
  function showSelectedDetails() {
    const checkboxes = document.querySelectorAll('input[name="sbSelect"]:checked');
const toastMsg = document.getElementById("toastMsg");
const toastEl = new bootstrap.Toast(document.getElementById("sbToast"));

if (checkboxes.length === 0) {
  toastMsg.innerText = "Please select one Shipping Bill.";
  toastEl.show();
  return;
}

if (checkboxes.length > 1) {
  toastMsg.innerText = "Please select only one Shipping Bill at a time.";
  toastEl.show();
  return;
}


    const checked = checkboxes[0];
    const row = checked.closest('tr');
    const expander = row.nextElementSibling;

    const headers = [
      "Shipping Bill", "Form No", "Shipping Bill Date", "Port Code", "Bank Name", "Invoice Count",
      "FOB Currency", "Export Bill Value", "Bill Outstanding Value", "Buyer Name", "Buyer Country Code",
      "IE Code", "Invoice Date", "Realized Value", "Buyer Address", "Consignee Country Code", "Port of Destination",
      "Shipping Company", "Vessel Name", "BL Date", "Commercial Invoice", "Trade Terms", "Commodity"
    ];

    const valuesMain = Array.from(row.children).slice(2).map(td => td.textContent.trim());
    const expanderTDs = Array.from(expander.querySelectorAll("tbody tr"))
      .flatMap(tr => Array.from(tr.children).slice(3).map(td => td.textContent.trim()));
    const allValues = valuesMain.concat(expanderTDs);

    const invoiceFieldSet = new Set([
      "Invoice Date", "Realized Value", "Buyer Address", "Consignee Country Code",
      "Port of Destination", "Shipping Company", "Vessel Name", "BL Date", "Commodity"
    ]);

    const nonEmptyPairs = headers.map((key, i) => [key, allValues[i]])
      .filter(([key, val]) => val && val !== "NA" && val !== "-" && !invoiceFieldSet.has(key));

    const invoiceFieldsPerEntry = 9;
    const invoiceLabels = Array.from(invoiceFieldSet);
    const numberOfInvoices = Math.floor(expanderTDs.length / invoiceFieldsPerEntry);
    const invoiceTabs = [];

    for (let i = 0; i < numberOfInvoices; i++) {
      const start = i * invoiceFieldsPerEntry;
      const invoiceData = expanderTDs.slice(start, start + invoiceFieldsPerEntry);
      const content = invoiceLabels.map((label, j) => `
        <div class="col-3 mb-3">
          <div class="detail-label">${label}</div>
          <div class="detail-value">${invoiceData[j]}</div>
        </div>`).join('');
      invoiceTabs.push({ title: `Invoice ${i + 1}`, content: `<div class="row">${content}</div>` });
    }

    const tabButtonsHTML = invoiceTabs.map((tab, i) => `
      <button class="${i === 0 ? 'active' : ''}" onclick="showTab(${i})">${tab.title}</button>
    `).join('');

    const tabContentHTML = invoiceTabs.map((tab, i) => `
      <div class="tab-content ${i === 0 ? 'active' : ''}" id="tab${i}">
        ${tab.content}
      </div>
    `).join('');

    const nonInvoiceFieldsHTML = `
      <div class="row mb-4">
        ${nonEmptyPairs.map(([k, v]) => `
          <div class="col-3 mb-3">
            <div class="detail-label">${k}</div>
            <div class="detail-value">${v}</div>
          </div>`).join('')}
      </div>
    `;
document.getElementById("modalContent").innerHTML = `
  ${nonInvoiceFieldsHTML}
  ${invoiceTabs.length > 0 ? `
    <div class="invoice-tabs">
      <div class="tab-buttons mb-3" style="max-width: 60%; flex-wrap: wrap;">
        ${tabButtonsHTML}
      </div>
      <div class="tab-container">
        ${tabContentHTML}
      </div>
    </div>
  ` : ''}

  <br><br>
  <div class="invoice-tabs">
  <br>
    <h4 style="margin-left: 20px;">Mapping History</h4>
  <br>
<table border="1" id="mainTable" style="width: 100%; border-collapse: collapse;">
  <thead>
    <tr>
      <th></th>
      <th>Shipping Bill</th>
      <th>Form No</th>
      <th>Shipping Bill Date</th>
      <th>Port Code</th>
      <th>Export Agency</th>
      <th>AD Code</th>
      <th>IE Code</th>
      <th>Invoice No</th>
      <th>Invoice Date</th>
      <th>FOB Currency</th>
      <th>Export Bill Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="expand-toggle" onclick="toggleExpander(this)" style="cursor: pointer; user-select:none; text-align:center; font-weight:bold;">
        ▸
      </td>
      <td>1234567</td>
      <td>NA</td>
      <td>10-05-2024</td>
      <td>INBOM4</td>
      <td>Customs</td>
      <td>6390000</td>
      <td>123456789</td>
      <td>21127240024-01</td>
      <td>05-05-2024</td>
      <td>USD</td>
      <td>10,000.00</td>
    </tr>

    <tr class="expander" style="display: none;">
      <td colspan="13" style="padding: 0;">
        <table border="1" style="width: 100%; border-collapse: collapse; margin: 0;">
          <thead>
            <tr>
              <th></th>
              <th></th>
              <th></th>
              <th>Realized Value</th>
              <th>Outstanding Value</th>
              <th>SB Utilization</th>
              <th>Remittance Ref No</th>
              <th>AD Code</th>
              <th>Bank Name</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td>6,000.00</td>
              <td>4,000.00</td>
              <td>2,000.00</td>
              <td>0002GRS12345678</td>
              <td>6390000</td>
              <td>ICICI Bank</td>
            </tr>
          </tbody>

          <thead>
            <tr>
              <th></th>
              <th></th>
              <th></th>
              <th>IE Code</th>
              <th>Remittance Date</th>
              <th>Purpose Code</th>
              <th>Remittance Currency</th>
              <th>Remittance Amount</th>
              <th>Utilized Amount</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td>123456789</td>
              <td>05-05-2024</td>
              <td>P0102</td>
              <td>USD</td>
              <td>40,000</td>
              <td>2,000</td>
            </tr>
          </tbody>

          <thead>
            <tr>
              <th></th>
              <th></th>
              <th></th>
              <th>Remittance Outstanding</th>
              <th>IRM Utilization</th>
              <th></th>
              <th></th>
              <th></th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td>38,000</td>
              <td>2,000</td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
          </tbody>
        </table>
      </td>
    </tr>
  </tbody>
</table>

</div>
`;



    new bootstrap.Modal(document.getElementById("detailsModal")).show();
  }

  function showTab(index) {
    const tabs = document.querySelectorAll('.tab-content');
    const buttons = document.querySelectorAll('.tab-buttons button');
    tabs.forEach((tab, i) => tab.classList.toggle('active', i === index));
    buttons.forEach((btn, i) => btn.classList.toggle('active', i === index));
  }

  function toggleExpander(el) {
    const row = el.parentElement;
    const nextRow = row.nextElementSibling;
    if (!nextRow || !nextRow.classList.contains('expander')) return;
    const expanded = nextRow.style.display === 'table-row';
    nextRow.style.display = expanded ? 'none' : 'table-row';
    el.textContent = expanded ? '▸' : '▾';
  }

  function downloadSample() {
    window.location.href = "../files/sample_sb.csv";
  }

  function filterTable(colIndex, value) {
    const table = document.querySelector("table:nth-of-type(2) tbody");
    const rows = table.querySelectorAll("tr");

    rows.forEach((row) => {
      if (row.classList.contains("expander")) return;
      const cell = row.querySelectorAll("td")[colIndex];
      const match = cell && cell.textContent.toLowerCase().includes(value.toLowerCase());
      row.style.display = match ? "" : "none";

      const expander = row.nextElementSibling;
      if (expander && expander.classList.contains("expander")) {
        expander.style.display = match ? "table-row" : "none";
      }
    });
  }

  function changeEntries() {
    const table = document.getElementById('mainTable');
    const rows = Array.from(table.querySelectorAll('tbody > tr'));
    const mainRows = rows.filter(row => !row.classList.contains('expander'));
    const selected = parseInt(document.getElementById('entriesSelect').value);
    let shownCount = 0;

    for (let i = 0; i < mainRows.length; i++) {
      const mainRow = mainRows[i];
      const expanderRow = mainRow.nextElementSibling?.classList.contains('expander') ? mainRow.nextElementSibling : null;

      if (shownCount < selected) {
        mainRow.style.display = '';
        if (expanderRow) {
          const toggleCell = mainRow.querySelector('.expand-toggle');
          expanderRow.style.display = (toggleCell && toggleCell.textContent === '▾') ? 'table-row' : 'none';
        }
        shownCount++;
      } else {
        mainRow.style.display = 'none';
        if (expanderRow) expanderRow.style.display = 'none';
        const toggleCell = mainRow.querySelector('.expand-toggle');
        if (toggleCell) toggleCell.textContent = '▸';
      }
    }
  }

  window.onload = () => {
    changeEntries();
  };
</script>

<script>
function modifySelectedSB() {
  const table = document.getElementById('mainTable');
  const checkboxes = table.querySelectorAll('tbody input[type="checkbox"]');
  let selectedRow = null;

  checkboxes.forEach((cb) => {
    if (cb.checked) {
      selectedRow = cb.closest('tr');
    }
  });

  if (!selectedRow) {
  document.getElementById("toastMsg").innerText = "Please select one Shipping Bill to modify.";
  const toastEl = new bootstrap.Toast(document.getElementById("sbToast"));
  toastEl.show();
  return;
}


  const headers = Array.from(table.querySelectorAll('thead th')).map(h =>
    h.textContent.trim().toLowerCase().replace(/\s+/g, '')
  );

  const mainCells = selectedRow.querySelectorAll('td');
  const expanderRow = selectedRow.nextElementSibling;
  const expanderCells = expanderRow && expanderRow.classList.contains('expander')
    ? expanderRow.querySelectorAll('td')
    : [];

  const allCells = [...mainCells, ...expanderCells];
  const params = new URLSearchParams();

  headers.forEach((header, index) => {
    if (header && allCells[index]) {
      const value = allCells[index].textContent.trim();
      params.append(header, value);
    }
  });

  window.location.href = `../screens/modify_sb.html?${params.toString()}`;
}
</script>



<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script src="../sidebar/sidebar_loader.js" defer></script>
<script src="../validations/country.js"></script>

</html>